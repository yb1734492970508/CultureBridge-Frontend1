/**
 * ÁøªËØëÈ°µÈù¢ÁªÑ‰ª∂
 * Êèê‰æõËØ≠Èü≥ÂíåÊñáÊú¨ÁøªËØëÂäüËÉΩ
 */

import React, { useState, useRef, useEffect } from 'react';
import { Card, CardContent, CardHeader, CardTitle } from '../components/ui/card';
import { Button } from '../components/ui/button';
import { Badge } from '../components/ui/badge';
import { Tabs, TabsContent, TabsList, TabsTrigger } from '../components/ui/tabs';
import { Textarea } from '../components/ui/textarea';
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '../components/ui/select';
import { 
  Mic, 
  MicOff, 
  Volume2, 
  VolumeX, 
  Copy, 
  Share2, 
  RotateCcw,
  Languages,
  Zap,
  Globe,
  History,
  Star,
  Play,
  Pause,
  Download
} from 'lucide-react';

const TranslationPage = () => {
  const [activeTab, setActiveTab] = useState('text');
  const [isRecording, setIsRecording] = useState(false);
  const [isPlaying, setIsPlaying] = useState(false);
  const [sourceText, setSourceText] = useState('');
  const [translatedText, setTranslatedText] = useState('');
  const [sourceLang, setSourceLang] = useState('zh-CN');
  const [targetLang, setTargetLang] = useState('en-US');
  const [isTranslating, setIsTranslating] = useState(false);
  
  const [translationHistory, setTranslationHistory] = useState([
    {
      id: 1,
      source: '‰Ω†Â•ΩÔºåÂæàÈ´òÂÖ¥ËÆ§ËØÜ‰Ω†',
      target: 'Hello, nice to meet you',
      sourceLang: 'zh-CN',
      targetLang: 'en-US',
      time: '5ÂàÜÈíüÂâç',
      type: 'text'
    },
    {
      id: 2,
      source: 'Comment allez-vous?',
      target: '‰Ω†Â•ΩÂêóÔºü',
      sourceLang: 'fr-FR',
      targetLang: 'zh-CN',
      time: '10ÂàÜÈíüÂâç',
      type: 'voice'
    }
  ]);

  const languages = [
    { code: 'zh-CN', name: '‰∏≠Êñá', flag: 'üá®üá≥' },
    { code: 'en-US', name: 'English', flag: 'üá∫üá∏' },
    { code: 'ja-JP', name: 'Êó•Êú¨Ë™û', flag: 'üáØüáµ' },
    { code: 'ko-KR', name: 'ÌïúÍµ≠Ïñ¥', flag: 'üá∞üá∑' },
    { code: 'fr-FR', name: 'Fran√ßais', flag: 'üá´üá∑' },
    { code: 'de-DE', name: 'Deutsch', flag: 'üá©üá™' },
    { code: 'es-ES', name: 'Espa√±ol', flag: 'üá™üá∏' },
    { code: 'it-IT', name: 'Italiano', flag: 'üáÆüáπ' },
    { code: 'pt-PT', name: 'Portugu√™s', flag: 'üáµüáπ' },
    { code: 'ru-RU', name: '–†—É—Å—Å–∫–∏–π', flag: 'üá∑üá∫' }
  ];

  const handleTranslate = async () => {
    if (!sourceText.trim()) return;
    
    setIsTranslating(true);
    
    // Ê®°ÊãüÁøªËØëAPIË∞ÉÁî®
    setTimeout(() => {
      const mockTranslations = {
        'zh-CN': {
          'en-US': 'Hello, this is a translation example.',
          'ja-JP': '„Åì„Çì„Å´„Å°„ÅØ„ÄÅ„Åì„Çå„ÅØÁøªË®≥„ÅÆ‰æã„Åß„Åô„ÄÇ',
          'ko-KR': 'ÏïàÎÖïÌïòÏÑ∏Ïöî, Ïù¥Í≤ÉÏùÄ Î≤àÏó≠ ÏòàÏãúÏûÖÎãàÎã§.'
        },
        'en-US': {
          'zh-CN': '‰Ω†Â•ΩÔºåËøôÊòØ‰∏Ä‰∏™ÁøªËØëÁ§∫‰æã„ÄÇ',
          'ja-JP': '„Åì„Çì„Å´„Å°„ÅØ„ÄÅ„Åì„Çå„ÅØÁøªË®≥„ÅÆ‰æã„Åß„Åô„ÄÇ',
          'ko-KR': 'ÏïàÎÖïÌïòÏÑ∏Ïöî, Ïù¥Í≤ÉÏùÄ Î≤àÏó≠ ÏòàÏãúÏûÖÎãàÎã§.'
        }
      };
      
      const result = mockTranslations[sourceLang]?.[targetLang] || 'ÁøªËØëÁªìÊûúÂ∞ÜÂú®ËøôÈáåÊòæÁ§∫...';
      setTranslatedText(result);
      
      // Ê∑ªÂä†Âà∞ÂéÜÂè≤ËÆ∞ÂΩï
      const newHistory = {
        id: Date.now(),
        source: sourceText,
        target: result,
        sourceLang,
        targetLang,
        time: 'ÂàöÂàö',
        type: activeTab
      };
      setTranslationHistory(prev => [newHistory, ...prev.slice(0, 9)]);
      
      setIsTranslating(false);
    }, 1500);
  };

  const handleVoiceRecord = () => {
    setIsRecording(!isRecording);
    if (!isRecording) {
      // Ê®°ÊãüËØ≠Èü≥ËØÜÂà´
      setTimeout(() => {
        setSourceText('ËøôÊòØÈÄöËøáËØ≠Èü≥ËØÜÂà´ÂæóÂà∞ÁöÑÊñáÊú¨');
        setIsRecording(false);
      }, 3000);
    }
  };

  const handlePlayAudio = () => {
    setIsPlaying(true);
    // Ê®°ÊãüÈü≥È¢ëÊí≠Êîæ
    setTimeout(() => {
      setIsPlaying(false);
    }, 2000);
  };

  const swapLanguages = () => {
    const tempLang = sourceLang;
    setSourceLang(targetLang);
    setTargetLang(tempLang);
    
    const tempText = sourceText;
    setSourceText(translatedText);
    setTranslatedText(tempText);
  };

  const copyToClipboard = (text) => {
    navigator.clipboard.writeText(text);
    // ËøôÈáåÂèØ‰ª•Ê∑ªÂä†ÊèêÁ§∫Ê∂àÊÅØ
  };

  const TextTranslation = () => (
    <div className="space-y-6">
      {/* ËØ≠Ë®ÄÈÄâÊã©Âô® */}
      <Card>
        <CardContent className="p-4">
          <div className="flex items-center gap-4">
            <div className="flex-1">
              <label className="text-sm font-medium text-gray-700 mb-2 block">Ê∫êËØ≠Ë®Ä</label>
              <Select value={sourceLang} onValueChange={setSourceLang}>
                <SelectTrigger>
                  <SelectValue />
                </SelectTrigger>
                <SelectContent>
                  {languages.map((lang) => (
                    <SelectItem key={lang.code} value={lang.code}>
                      <span className="flex items-center gap-2">
                        <span>{lang.flag}</span>
                        <span>{lang.name}</span>
                      </span>
                    </SelectItem>
                  ))}
                </SelectContent>
              </Select>
            </div>
            
            <Button
              variant="outline"
              size="sm"
              onClick={swapLanguages}
              className="mt-6"
            >
              <RotateCcw className="w-4 h-4" />
            </Button>
            
            <div className="flex-1">
              <label className="text-sm font-medium text-gray-700 mb-2 block">ÁõÆÊ†áËØ≠Ë®Ä</label>
              <Select value={targetLang} onValueChange={setTargetLang}>
                <SelectTrigger>
                  <SelectValue />
                </SelectTrigger>
                <SelectContent>
                  {languages.map((lang) => (
                    <SelectItem key={lang.code} value={lang.code}>
                      <span className="flex items-center gap-2">
                        <span>{lang.flag}</span>
                        <span>{lang.name}</span>
                      </span>
                    </SelectItem>
                  ))}
                </SelectContent>
              </Select>
            </div>
          </div>
        </CardContent>
      </Card>

      {/* ÁøªËØëÂå∫Âüü */}
      <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <Card>
          <CardHeader>
            <CardTitle className="text-sm font-medium">
              {languages.find(l => l.code === sourceLang)?.name}
            </CardTitle>
          </CardHeader>
          <CardContent>
            <Textarea
              placeholder="ËæìÂÖ•Ë¶ÅÁøªËØëÁöÑÊñáÊú¨..."
              value={sourceText}
              onChange={(e) => setSourceText(e.target.value)}
              className="min-h-32 resize-none"
            />
            <div className="flex items-center justify-between mt-3">
              <div className="text-xs text-gray-500">
                {sourceText.length}/5000
              </div>
              <div className="flex gap-2">
                <Button size="sm" variant="outline" onClick={() => setSourceText('')}>
                  Ê∏ÖÁ©∫
                </Button>
                <Button 
                  size="sm" 
                  onClick={handleTranslate}
                  disabled={!sourceText.trim() || isTranslating}
                >
                  {isTranslating ? (
                    <>
                      <Zap className="w-4 h-4 mr-1 animate-spin" />
                      ÁøªËØë‰∏≠...
                    </>
                  ) : (
                    <>
                      <Languages className="w-4 h-4 mr-1" />
                      ÁøªËØë
                    </>
                  )}
                </Button>
              </div>
            </div>
          </CardContent>
        </Card>

        <Card>
          <CardHeader>
            <CardTitle className="text-sm font-medium">
              {languages.find(l => l.code === targetLang)?.name}
            </CardTitle>
          </CardHeader>
          <CardContent>
            <div className="min-h-32 p-3 bg-gray-50 rounded-md border">
              {translatedText || (
                <span className="text-gray-400">ÁøªËØëÁªìÊûúÂ∞ÜÂú®ËøôÈáåÊòæÁ§∫...</span>
              )}
            </div>
            <div className="flex items-center justify-between mt-3">
              <div className="text-xs text-gray-500">
                {translatedText.length} Â≠óÁ¨¶
              </div>
              <div className="flex gap-2">
                <Button 
                  size="sm" 
                  variant="outline"
                  onClick={handlePlayAudio}
                  disabled={!translatedText || isPlaying}
                >
                  {isPlaying ? (
                    <Pause className="w-4 h-4" />
                  ) : (
                    <Volume2 className="w-4 h-4" />
                  )}
                </Button>
                <Button 
                  size="sm" 
                  variant="outline"
                  onClick={() => copyToClipboard(translatedText)}
                  disabled={!translatedText}
                >
                  <Copy className="w-4 h-4" />
                </Button>
                <Button 
                  size="sm" 
                  variant="outline"
                  disabled={!translatedText}
                >
                  <Share2 className="w-4 h-4" />
                </Button>
              </div>
            </div>
          </CardContent>
        </Card>
      </div>
    </div>
  );

  const VoiceTranslation = () => (
    <div className="space-y-6">
      {/* ËØ≠Èü≥ÁøªËØëÊéßÂà∂ */}
      <Card className="bg-gradient-to-r from-blue-50 to-purple-50">
        <CardContent className="p-8 text-center">
          <div className="mb-6">
            <h2 className="text-2xl font-bold mb-2">ÂÆûÊó∂ËØ≠Èü≥ÁøªËØë</h2>
            <p className="text-gray-600">ÁÇπÂáªÈ∫¶ÂÖãÈ£éÂºÄÂßãÂΩïÈü≥ÔºåÊùæÂºÄËá™Âä®ÁøªËØë</p>
          </div>
          
          <div className="flex justify-center mb-6">
            <Button
              size="lg"
              onClick={handleVoiceRecord}
              className={`w-24 h-24 rounded-full ${
                isRecording 
                  ? 'bg-red-500 hover:bg-red-600 animate-pulse' 
                  : 'bg-blue-500 hover:bg-blue-600'
              }`}
            >
              {isRecording ? (
                <MicOff className="w-8 h-8" />
              ) : (
                <Mic className="w-8 h-8" />
              )}
            </Button>
          </div>
          
          <div className="text-sm text-gray-600">
            {isRecording ? 'Ê≠£Âú®ÂΩïÈü≥...' : 'ÁÇπÂáªÂºÄÂßãÂΩïÈü≥'}
          </div>
        </CardContent>
      </Card>

      {/* ËØ≠Èü≥ÁøªËØëÁªìÊûú */}
      <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <Card>
          <CardHeader>
            <CardTitle className="flex items-center gap-2">
              <span className="text-blue-600">üé§</span>
              ËØÜÂà´ÁªìÊûú
            </CardTitle>
          </CardHeader>
          <CardContent>
            <div className="p-4 bg-blue-50 rounded-lg min-h-24">
              {sourceText || (
                <span className="text-gray-400">ËØ≠Èü≥ËØÜÂà´ÁªìÊûúÂ∞ÜÂú®ËøôÈáåÊòæÁ§∫...</span>
              )}
            </div>
            <div className="flex gap-2 mt-3">
              <Button size="sm" variant="outline">
                <Play className="w-4 h-4 mr-1" />
                Êí≠ÊîæÂéüÈü≥
              </Button>
              <Button size="sm" variant="outline">
                <Copy className="w-4 h-4 mr-1" />
                Â§çÂà∂
              </Button>
            </div>
          </CardContent>
        </Card>

        <Card>
          <CardHeader>
            <CardTitle className="flex items-center gap-2">
              <span className="text-green-600">üîä</span>
              ÁøªËØëÁªìÊûú
            </CardTitle>
          </CardHeader>
          <CardContent>
            <div className="p-4 bg-green-50 rounded-lg min-h-24">
              {translatedText || (
                <span className="text-gray-400">ÁøªËØëÁªìÊûúÂ∞ÜÂú®ËøôÈáåÊòæÁ§∫...</span>
              )}
            </div>
            <div className="flex gap-2 mt-3">
              <Button size="sm" variant="outline" onClick={handlePlayAudio}>
                {isPlaying ? (
                  <Pause className="w-4 h-4 mr-1" />
                ) : (
                  <Volume2 className="w-4 h-4 mr-1" />
                )}
                Êí≠ÊîæÁøªËØë
              </Button>
              <Button size="sm" variant="outline">
                <Download className="w-4 h-4 mr-1" />
                ‰∏ãËΩΩÈü≥È¢ë
              </Button>
            </div>
          </CardContent>
        </Card>
      </div>
    </div>
  );

  const TranslationHistory = () => (
    <div className="space-y-4">
      <div className="flex items-center justify-between">
        <h3 className="text-lg font-semibold">ÁøªËØëÂéÜÂè≤</h3>
        <Button variant="outline" size="sm">
          <History className="w-4 h-4 mr-1" />
          Ê∏ÖÁ©∫ÂéÜÂè≤
        </Button>
      </div>
      
      {translationHistory.map((item) => (
        <Card key={item.id} className="hover:shadow-md transition-shadow">
          <CardContent className="p-4">
            <div className="flex items-start justify-between mb-3">
              <div className="flex items-center gap-2">
                <Badge variant="outline" className="text-xs">
                  {item.type === 'voice' ? 'üé§ ËØ≠Èü≥' : 'üìù ÊñáÊú¨'}
                </Badge>
                <span className="text-xs text-gray-500">{item.time}</span>
              </div>
              <div className="flex gap-1">
                <Button size="sm" variant="ghost">
                  <Star className="w-3 h-3" />
                </Button>
                <Button size="sm" variant="ghost">
                  <Copy className="w-3 h-3" />
                </Button>
              </div>
            </div>
            
            <div className="space-y-2">
              <div className="flex items-center gap-2 text-sm">
                <span>{languages.find(l => l.code === item.sourceLang)?.flag}</span>
                <span className="font-medium">{item.source}</span>
              </div>
              <div className="flex items-center gap-2 text-sm">
                <span>{languages.find(l => l.code === item.targetLang)?.flag}</span>
                <span className="text-gray-600">{item.target}</span>
              </div>
            </div>
          </CardContent>
        </Card>
      ))}
    </div>
  );

  return (
    <div className="min-h-screen bg-gray-50">
      {/* Â§¥ÈÉ®Ê®™ÂπÖ */}
      <div className="bg-gradient-to-r from-blue-600 to-purple-700 text-white py-16">
        <div className="container mx-auto px-4 text-center">
          <h1 className="text-4xl font-bold mb-4">
            <Languages className="inline-block w-10 h-10 mr-3" />
            Êô∫ËÉΩÁøªËØë
          </h1>
          <p className="text-xl opacity-90 max-w-2xl mx-auto">
            ÊîØÊåÅÂ§öÁßçËØ≠Ë®ÄÁöÑÊñáÊú¨ÂíåËØ≠Èü≥ÁøªËØëÔºåËÆ©Ê≤üÈÄöÊó†ÂõΩÁïå
          </p>
        </div>
      </div>

      <div className="container mx-auto px-4 py-8">
        <Tabs value={activeTab} onValueChange={setActiveTab} className="space-y-6">
          <TabsList className="grid w-full grid-cols-3">
            <TabsTrigger value="text">ÊñáÊú¨ÁøªËØë</TabsTrigger>
            <TabsTrigger value="voice">ËØ≠Èü≥ÁøªËØë</TabsTrigger>
            <TabsTrigger value="history">ÁøªËØëÂéÜÂè≤</TabsTrigger>
          </TabsList>

          <TabsContent value="text" className="space-y-6">
            <TextTranslation />
          </TabsContent>

          <TabsContent value="voice" className="space-y-6">
            <VoiceTranslation />
          </TabsContent>

          <TabsContent value="history" className="space-y-6">
            <TranslationHistory />
          </TabsContent>
        </Tabs>

        {/* ÂäüËÉΩÁâπËâ≤ */}
        <div className="mt-12 grid grid-cols-1 md:grid-cols-3 gap-6">
          <Card className="text-center p-6">
            <Globe className="w-12 h-12 text-blue-600 mx-auto mb-4" />
            <h3 className="font-semibold mb-2">Â§öËØ≠Ë®ÄÊîØÊåÅ</h3>
            <p className="text-sm text-gray-600">ÊîØÊåÅ50+ÁßçËØ≠Ë®ÄÁöÑ‰∫íËØë</p>
          </Card>
          
          <Card className="text-center p-6">
            <Zap className="w-12 h-12 text-yellow-600 mx-auto mb-4" />
            <h3 className="font-semibold mb-2">ÂÆûÊó∂ÁøªËØë</h3>
            <p className="text-sm text-gray-600">ÊØ´ÁßíÁ∫ßÂìçÂ∫îÔºåÂç≥Êó∂Ëé∑ÂæóÁªìÊûú</p>
          </Card>
          
          <Card className="text-center p-6">
            <Mic className="w-12 h-12 text-green-600 mx-auto mb-4" />
            <h3 className="font-semibold mb-2">ËØ≠Èü≥ËØÜÂà´</h3>
            <p className="text-sm text-gray-600">È´òÁ≤æÂ∫¶ËØ≠Èü≥ËØÜÂà´ÂíåÂêàÊàê</p>
          </Card>
        </div>
      </div>
    </div>
  );
};

export default TranslationPage;

